// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums

enum UserRole {
  USER
  ADMIN
}

enum IcebreakerStatus {
  PENDING
  ACCEPTED
  REJECTED
}

// Models

model User {
  id              String   @id @default(cuid()) // PERBAIKAN: Menggunakan CUID, bukan Int
  email           String   @unique
  passwordHash    String // PERBAIKAN: Nama diubah dari 'password'
  firstName       String
  lastName        String
  birthDate       DateTime
  bio             String?
  jobTitle        String?
  education       String?
  role            UserRole @default(USER)
  focusSlotsLimit Int      @default(5)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  conversationCards   ConversationCard[]
  sentIcebreakers     Icebreaker[]       @relation("SentIcebreakers")
  receivedIcebreakers Icebreaker[]       @relation("ReceivedIcebreakers")
  matchesAsUserA      Match[]            @relation("UserA")
  matchesAsUserB      Match[]            @relation("UserB")
  sentMessages        Message[]
}

model ConversationCard {
  id         String   @id @default(cuid()) // PERBAIKAN: Menggunakan CUID
  mediaUrl   String
  promptText String
  createdAt  DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String // PERBAIKAN: Tipe diubah ke String

  icebreakers Icebreaker[]
}

model Icebreaker {
  id         String           @id @default(cuid()) // PERBAIKAN: Menggunakan CUID
  content    String
  status     IcebreakerStatus @default(PENDING)
  createdAt  DateTime         @default(now())

  sender     User   @relation("SentIcebreakers", fields: [senderId], references: [id], onDelete: Cascade)
  senderId   String // PERBAIKAN: Tipe diubah ke String
  receiver   User   @relation("ReceivedIcebreakers", fields: [receiverId], references: [id], onDelete: Cascade)
  receiverId String // PERBAIKAN: Tipe diubah ke String

  targetCard   ConversationCard @relation(fields: [targetCardId], references: [id], onDelete: Cascade)
  targetCardId String // PERBAIKAN: Tipe diubah ke String

  @@unique([senderId, receiverId, targetCardId])
}

model Match {
  id        String   @id @default(cuid()) // PERBAIKAN: Menggunakan CUID
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  userA   User   @relation("UserA", fields: [userAId], references: [id], onDelete: Cascade)
  userAId String // PERBAIKAN: Tipe diubah ke String
  userB   User   @relation("UserB", fields: [userBId], references: [id], onDelete: Cascade)
  userBId String // PERBAIKAN: Tipe diubah ke String

  messages Message[]

  @@unique([userAId, userBId])
}

model Message {
  id        String   @id @default(cuid()) // PERBAIKAN: Menggunakan CUID
  content   String
  createdAt DateTime @default(now())

  match   Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)
  matchId String // PERBAIKAN: Tipe diubah ke String
  sender  User   @relation(fields: [senderId], references: [id], onDelete: Cascade)
  senderId String // PERBAIKAN: Tipe diubah ke String
}